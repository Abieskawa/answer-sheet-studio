<!doctype html>
<html lang="{{ 'en' if lang == 'en' else 'zh-Hant' }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or t.result_plots_title }}</title>
  <style>
    :root { color-scheme: light; }
    body { margin: 0; background: #fff; color: #111827; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "PingFang TC", "Microsoft JhengHei", sans-serif; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px 18px 40px; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    .meta { margin: 0 0 18px; color: #6b7280; font-size: 13px; }
    .meta code { background: #f3f4f6; padding: 2px 6px; border-radius: 6px; }
    .toolbar { display: flex; gap: 10px; flex-wrap: wrap; margin: 12px 0 18px; }
    .btn { display: inline-block; padding: 10px 12px; border-radius: 10px; border: 1px solid #e5e7eb; text-decoration: none; color: #111827; background: #fff; }
    .btn:hover { background: #f9fafb; }
    .plots { display: grid; gap: 14px; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px; background: #fff; }
    .hint { margin: 0 0 8px; font-size: 13px; color: #6b7280; }
    img { width: 100%; height: auto; display: block; background: #fff; }
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #e5e7eb; text-align: left; white-space: nowrap; }
    thead th { position: sticky; top: 0; background: #f9fafb; z-index: 1; border-bottom: 1px solid #d1d5db; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>{{ t.result_plots_title }}</h1>
    <p class="meta">{{ t.result_file }}<code>{{ display_filename }}</code> Â· {{ t.result_job_id }}<code>{{ job_id }}</code></p>

    <div class="toolbar">
      <a class="btn" href="{{ csv_url }}" target="_blank" rel="noopener noreferrer">{{ t.result_download_results }}</a>
      <a class="btn" href="{{ pdf_url }}" target="_blank" rel="noopener noreferrer">{{ t.result_download_annotated }}</a>
      {% if showwrong_url %}
        <a class="btn" href="{{ showwrong_url }}" target="_blank" rel="noopener noreferrer">{{ t.result_download_showwrong }}</a>
      {% endif %}
      {% if analysis_scores_by_class_url %}
        <a class="btn" href="{{ analysis_scores_by_class_url }}" target="_blank" rel="noopener noreferrer">{{ t.result_download_scores_by_class }}</a>
      {% endif %}
    </div>

    {% if analysis_error %}
      <p class="hint" style="color:#b91c1c">{{ analysis_error }}</p>
    {% endif %}
    {% if analysis_message %}
      <p class="hint">{{ analysis_message }}</p>
    {% endif %}
    {% if analysis_discrimination_note_key %}
      <p class="hint">{{ t[analysis_discrimination_note_key] }}</p>
    {% endif %}

    <div class="plots">
      {% if analysis_score_hist_inline_url %}
        <div class="card">
          <p class="hint">{{ t.result_plot_score_hist }}</p>
          <img src="{{ analysis_score_hist_inline_url }}" alt="{{ t.result_plot_score_hist }}" loading="lazy" />
        </div>
      {% endif %}
      {% if analysis_item_plot_inline_url %}
        <div class="card">
          <p class="hint">{{ t.result_plot_item_metrics }}</p>
          <img src="{{ analysis_item_plot_inline_url }}" alt="{{ t.result_plot_item_metrics }}" loading="lazy" />
        </div>
      {% endif %}
    </div>

    {% if analysis_files %}
      <div class="card" style="margin-top:14px">
        <p class="hint">{{ t.result_analysis_files_title }}</p>
        <p class="hint">{{ t.result_analysis_files_hint }}</p>
        <div class="toolbar" style="margin:0">
          {% for f in analysis_files %}
            <a class="btn" href="{{ f.url }}" target="_blank" rel="noopener noreferrer">{{ f.label }}</a>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if analysis_item_table %}
      <div class="card" style="margin-top:14px">
        <details>
          <summary class="hint" style="cursor:pointer">{{ t.result_item_table_title }}</summary>
          <p class="hint">{{ t.result_item_table_hint }}</p>
          {% if analysis_item_table.truncated %}
            <p class="hint">{{ t.result_item_table_truncated.format(total_rows=analysis_item_table.total_rows, shown_rows=analysis_item_table.shown_rows) }}</p>
          {% endif %}
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  {% for h in analysis_item_table.header %}
                    <th>{{ h }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for r in analysis_item_table.rows %}
                  <tr>
                    {% for cell in r %}
                      <td>{{ cell }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </details>
      </div>
    {% endif %}
  </div>
</body>
</html>
