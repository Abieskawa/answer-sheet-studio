<!doctype html>
<html lang="{{ 'en' if lang == 'en' else 'zh-Hant' }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Answer Sheet Studio" }}</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">Answer Sheet Studio</div>
      <nav class="nav">
        <div class="nav-links">
          <a href="/">{{ t.nav_download }}</a>
          <a href="/upload">{{ t.nav_upload }}</a>
        </div>
        <div class="lang-switch" aria-label="Language">
          <button type="button" class="lang-tab{% if lang == 'zh-Hant' %} active{% endif %}" data-lang="zh-Hant">{{ t.lang_zh }}</button>
          <button type="button" class="lang-tab{% if lang == 'en' %} active{% endif %}" data-lang="en">{{ t.lang_en }}</button>
        </div>
      </nav>
    </header>

    <main class="card">
      {% block content %}{% endblock %}
    </main>

    <footer class="footer">
      <div>
        {{ t.footer_local }} ·
        <a href="https://answer-sheet-studio.readthedocs.io/" target="_blank" rel="noopener noreferrer">{{ t.footer_docs }}</a>
        ·
        <a href="https://github.com/Abieskawa/answer-sheet-studio/releases/latest" target="_blank" rel="noopener noreferrer">{{ t.footer_download }}</a>
      </div>
    </footer>
  </div>

  <script>
    (() => {
      const maxAge = 60 * 60 * 24 * 365;
      document.querySelectorAll(".lang-tab").forEach((btn) => {
        btn.addEventListener("click", () => {
          const value = btn.dataset.lang;
          if (!value) return;
          document.cookie = `lang=${value}; Path=/; Max-Age=${maxAge}; SameSite=Lax`;
          const url = new URL(window.location.href);
          url.searchParams.delete("lang");
          window.location.href = url.toString();
        });
      });
    })();

    (() => {
      const intervalSec = Number("{{ heartbeat_interval_sec|default(60) }}") || 60;
      const ping = () => {
        fetch("/api/heartbeat", { method: "POST", keepalive: true }).catch(() => {});
      };
      ping();
      window.setInterval(ping, Math.max(15, intervalSec) * 1000);
      window.addEventListener("pagehide", ping, { capture: true });
      window.addEventListener("visibilitychange", () => {
        if (!document.hidden) ping();
      });
    })();
  </script>
</body>
</html>
